<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <title>Pokémon</title>
  </head>

  <body>
    <main class="container">
      <h1>Pokémon</h1>
      <p class="lead">Gotta catch 'em all</p>
      <div class="row">
        <div class="col-md-6">
          <div class="card mb-2">
            <div class="card-body">
              <h2>Player 1</h2>
              <select class="form-select mb-1" id="player1-pokemon">
                <option value="-1" selected>Kies je pokémon</option>
              </select>
              <img
                src="img/pokeball.png"
                class="mx-auto d-block"
                id="player1-img"
              />
              <table class="table">
                <tr>
                  <th>HP (resterend)</th>
                  <td id="player1-hp">-</td>
                </tr>
                <tr>
                  <th>Type</th>
                  <td id="player1-type">-</td>
                </tr>
                <tr>
                  <th>Attack (min)</th>
                  <td id="player1-min">-</td>
                </tr>
                <tr>
                  <th>Attack (max)</th>
                  <td id="player1-max">-</td>
                </tr>
              </table>
              <div class="d-grid">
                <button class="btn btn-primary" id="player1-attack">
                  Aanvallen
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <h2>Player 2</h2>
              <select class="form-select mb-1" id="player2-pokemon">
                <option value="-1" selected>Kies je pokémon</option>
              </select>
              <img
                src="img/pokeball.png"
                class="mx-auto d-block"
                id="player2-img"
              />
              <table class="table">
                <tr>
                  <th>HP (resterend)</th>
                  <td id="player2-hp">-</td>
                </tr>
                <tr>
                  <th>Type</th>
                  <td id="player2-type">-</td>
                </tr>
                <tr>
                  <th>Attack (min)</th>
                  <td id="player2-min">-</td>
                </tr>
                <tr>
                  <th>Attack (max)</th>
                  <td id="player2-max">-</td>
                </tr>
              </table>
              <div class="d-grid">
                <button class="btn btn-primary" id="player2-attack">
                  Aanvallen
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="col mt-3 mb-2">
          <div class="card text-center">
            <div class="card-body" id="actioninfo">-</div>
          </div>
        </div>
      </div>
    </main>
    <script>
      class Player{
        constructor(name, pokemon){
          this.name = name
          this.pokemon = pokemon
          this.prefix = name.toLowerCase().replace(/\s/g, '')
        }
        get ActivePokemon() {
          let selected = document.querySelector(`#${this.prefix}-pokemon`).value
          if (selected == '-1') return null
          return this.pokemon[selected]
        }
      }

      class Pokemon{
        constructor(name, type, attackmin, attackmax, hitpoints, image){
          this.name = name
          this.type = type
          this.attackmin = attackmin
          this.attackmax = attackmax
          this.hitpoints = hitpoints
          this.image = image
          this.currentHP = hitpoints
        }
        Attack(){
          let miss = Math.floor(Math.random()*4) + 1
          if(miss == 1) return 0
          console.log(`${this.name} missed their attack`)
          return Math.floor(
            Math.random()*(Math.floor(this.attackmax) - Math.ceil(this.attackmin) +1) +
           Math.ceil(this.attackmin))
          
        }
        HP(){
          return `${this.hitpoints}(${this.currentHP})`
        }
      }

      let player1 = new Player('player 1', [])
      let player2 = new Player('player 2', [])
      let actioninfo = document.querySelector('#actioninfo')


      player1.pokemon.push(
        new Pokemon('Squirtle', 'Water', 10, 20, 100, 'Squirtle.gif')
        )
      player1.pokemon.push(
        new Pokemon('Charmander', 'Fire', 20, 40, 90, 'Charmander.gif')
        )
      player2.pokemon.push(
        new Pokemon('Squirtle', 'water', 10, 20, 100, 'Squirtle.gif')
        )
      player2.pokemon.push(
        new Pokemon('Charmander', 'Fire', 20, 40, 90, 'Charmander.gif')
        )

        player1.pokemon.forEach((pokemon, index) => {
          let option = document.createElement('option')
          option.value = index
          option.textContent = pokemon.name
          document.querySelector(`#${player1.prefix}-pokemon`).appendChild(option)
        });

        player2.pokemon.forEach((pokemon, index) => {
          let option = document.createElement('option')
          option.value = index
          option.textContent = pokemon.name
          document.querySelector(`#${player2.prefix}-pokemon`).appendChild(option)
        });

        document.querySelector('#player1-pokemon').addEventListener('change', ()=>update(player1))
        document.querySelector('#player2-pokemon').addEventListener('change', ()=>update(player2))
        document.querySelector('#player1-attack').addEventListener('click', ()=>attack(player1, player2))
        document.querySelector('#player2-attack').addEventListener('click', ()=>attack(player2, player1))

        function update(player){
          if (player.ActivePokemon == null) return
          document.querySelector(`#${player.prefix}-img`).src = 'img/' + player.ActivePokemon.image
          document.querySelector(`#${player.prefix}-hp`).textContent = player.ActivePokemon.HP()
          document.querySelector(`#${player.prefix}-type`).textContent = player.ActivePokemon.type
          document.querySelector(`#${player.prefix}-min`).textContent = player.ActivePokemon.attackmin
          document.querySelector(`#${player.prefix}-max`).textContent = player.ActivePokemon.attackmax
        }
        function attack(playerAttack, playerDefend){
          console.log('ik werk')
          const pokemonAttack = playerAttack.ActivePokemon
          const pokemonDefend = playerDefend.ActivePokemon
          

          if (pokemonAttack.currentHP <= 0) return alert(`${pokemonAttack.name} is fainted, you can't attack!`)

          let damage = pokemonAttack.Attack()
          pokemonDefend.currentHP -= damage
          update(playerDefend)

          if (pokemonDefend.currentHP <= 0) return actioninfo.textContent = `${pokemonAttack.name} attacked with ${damage}, ${pokemonDefend.name} is dead!`
          return `${pokemonAttack.name} attacked with ${damage}, ${pokemonDefend.name} has ${pokemonDefend.currentHP} left!`

        }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
